# Netlify configuration file

# Build settings for a static front-end application.
# The 'publish' directory should contain your index.html.
[build]
  command = "npm run build"
  publish = "dist"

# Netlify Functions configuration
[functions]
  directory = "netlify/functions"

# Redirect and rewrite rules for Single Page Applications (SPAs).
# This rule ensures that any direct navigation to a deep link
# (e.g., /notes/123) is correctly handled by your app's router.
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

# Custom headers to enhance security and control caching behavior.
[[headers]]
  for = "/*"
  [headers.values]
    # Prevents the site from being rendered in an <iframe>, protecting against clickjacking.
    X-Frame-Options = "DENY"
    # Enables the browser's built-in XSS protection.
    X-XSS-Protection = "1; mode=block"
    # Prevents the browser from sending the full URL as a referrer.
    Referrer-Policy = "strict-origin-when-cross-origin"
    # Prevents the browser from MIME-sniffing the content type.
    X-Content-Type-Options = "nosniff"
    # A robust Content Security Policy (CSP) to mitigate XSS attacks.
    # It restricts sources for scripts, styles, and other assets.
    Content-Security-Policy = "default-src 'self' https://aistudiocdn.com; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data:; connect-src 'self' https://bible-api.com https://generativelanguage.googleapis.com;"
    # A modern permissions policy to control access to sensitive APIs.
    Permissions-Policy = "geolocation=(), microphone=(), camera=()"

# Specific caching policy for the service worker file.
[[headers]]
  for = "/sw.js"
  [headers.values]
    # Ensures that the service worker file itself is never cached by the browser,
    # allowing for immediate updates when you deploy a new version.
    Cache-Control = "no-cache"

# Caching policy for immutable assets (assets that never change).
[[headers]]
  for = "/neka-fav.png"
  [headers.values]
    # Tells the browser to cache this file for one year.
    Cache-Control = "public, max-age=31536000, immutable"
